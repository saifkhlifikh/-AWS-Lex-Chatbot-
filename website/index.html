<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PawlPal â€” Chat Assistant</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --primary:#1FA2A2;
      --accent:#FF7A66;
      --bg-gradient-start:#2AA6A6;
      --bg-gradient-end:#1F7F7F;
      --card-bg:rgba(255,255,255,0.9);
      --text:#21313a;
      --muted:#6b7a7a;
      --glass: rgba(255,255,255,0.6);
      --radius-lg:20px;
    }
    /* Dark mode tokens */
    body.dark{ --card-bg: rgba(30,40,42,0.92); --text:#e6f4f2; --muted:#9ab6b5 }

    *{box-sizing:border-box}
    body{margin:0;font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;min-height:100vh;color:var(--text);background:linear-gradient(135deg,var(--bg-gradient-start),var(--bg-gradient-end));-webkit-font-smoothing:antialiased}

    /* Page layout */
    .wrap{max-width:1100px;margin:36px auto;padding:20px}
    .hero{display:flex;gap:28px;align-items:flex-start}

    /* Mascot column */
    .mascot-wrap{flex:0 0 220px;display:flex;flex-direction:column;align-items:center}
    .mascot{width:180px;height:180px;border-radius:50%;background:linear-gradient(135deg,var(--accent),#FFB199);display:flex;align-items:center;justify-content:center;box-shadow:0 18px 40px rgba(0,0,0,0.18);transform-origin:center;animation:mascotFloat 4s ease-in-out infinite}
    @keyframes mascotFloat{0%{transform:translateY(0)}50%{transform:translateY(-12px) rotate(-2deg)}100%{transform:translateY(0)}}
    .mascot svg{width:88px;height:88px}
    .mascot-badge{margin-top:12px;color:#fff;font-weight:700}

    /* Chat card */
    .chat-card{flex:1;background:var(--card-bg);border-radius:var(--radius-lg);padding:18px;box-shadow:0 24px 60px rgba(0,0,0,0.22);backdrop-filter:blur(8px);min-height:520px;display:flex;flex-direction:column}

    .chat-header{display:flex;align-items:center;gap:12px}
    .bot-avatar{width:56px;height:56px;border-radius:12px;background:linear-gradient(180deg,var(--primary),#138282);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;box-shadow:0 6px 18px rgba(0,0,0,0.12)}
    .bot-title{font-size:18px;font-weight:700}
    .bot-sub{font-size:13px;color:var(--muted)}

    /* conversation area */
    .conversation{flex:1;overflow:auto;padding:18px 12px;margin-top:16px;border-radius:12px;background:linear-gradient(180deg,rgba(250,255,255,0.7),rgba(250,255,255,0.45));}
    .msg{display:flex;margin-bottom:12px;align-items:flex-end;gap:10px}
    .msg.bot{justify-content:flex-start}
    .msg.user{justify-content:flex-end}

    .bubble{max-width:74%;padding:12px 14px;border-radius:14px;line-height:1.38;box-shadow:0 8px 18px rgba(19,28,29,0.06)}
    .bubble.bot{background:#ffffff;border:1px solid rgba(20,170,170,0.06);border-top-left-radius:6px}
    .bubble.user{background:linear-gradient(90deg,var(--primary),#17b6b6);color:#fff;border-top-right-radius:6px}

    .meta{font-size:11px;color:var(--muted);margin-top:6px}

    /* typing indicator */
    .typing{display:inline-flex;gap:6px;align-items:center}
    .dot{width:7px;height:7px;background:#cfdfe0;border-radius:50%;animation:dots 1s infinite}
    .dot:nth-child(2){animation-delay:0.15s}
    .dot:nth-child(3){animation-delay:0.3s}
    @keyframes dots{0%{transform:translateY(0);opacity:0.6}50%{transform:translateY(-6px);opacity:1}100%{transform:translateY(0);opacity:0.6}}

    /* input area */
    .composer{display:flex;gap:10px;padding:12px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.95),rgba(255,255,255,0.9));align-items:center}
    .composer input{flex:1;padding:12px 14px;border-radius:10px;border:1px solid rgba(30,40,40,0.06);outline:none;font-size:15px}
    .composer .send{background:var(--accent);color:white;padding:10px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer}
    .composer .actions{display:flex;gap:8px}
    .chip{background:rgba(0,0,0,0.06);padding:8px 10px;border-radius:999px;font-size:13px;cursor:pointer}

    /* language & toggles */
    .controls{display:flex;gap:8px;align-items:center;margin-left:auto}
    .lang-btn{padding:6px 8px;border-radius:8px;border:1px solid rgba(0,0,0,0.05);cursor:pointer;background:transparent}
    .lang-btn.active{background:var(--primary);color:#fff}

    /* responsive */
    @media (max-width:900px){
      .hero{flex-direction:column;align-items:center}
      .mascot-wrap{order:2}
      .chat-card{width:100%;min-height:520px}
    }
    @media (max-width:480px){
      .mascot{width:130px;height:130px}
      .bot-avatar{width:48px;height:48px}
      .conversation{padding:12px}
    }

    /* high contrast */
    body.high-contrast{filter:contrast(1.15) saturate(1.1)}

  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="mascot-wrap">
        <div class="mascot" role="img" aria-label="PawlPal mascot">
          <!-- simple paw SVG as mascot -->
          <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#fff" stop-opacity="0.25"/><stop offset="1" stop-color="#fff" stop-opacity="0.08"/></linearGradient></defs>
            <circle cx="32" cy="32" r="30" fill="url(#g)" />
            <path d="M32 38c-6 0-12 4-12 10s5 10 12 10 12-4 12-10-6-10-12-10zm-17-6c4 0 7-4 7-8s-3-8-7-8-7 4-7 8 3 8 7 8zM49 32c4 0 7-4 7-8s-3-8-7-8-7 4-7 8 3 8 7 8zM22 18c3 0 6-3 6-7s-3-7-6-7-6 3-6 7 3 7 6 7z" fill="#fff" opacity="0.95"/>
          </svg>
        </div>
        <div class="mascot-badge">PawlPal</div>
      </div>

      <div class="chat-card" role="region" aria-label="PawlPal chat interface">
        <div class="chat-header">
          <div class="bot-avatar" aria-hidden="true">PP</div>
          <div>
            <div class="bot-title" data-i18n="hero.title">Your Pet's Best Friend</div>
            <div class="bot-sub" data-i18n="hero.subtitle">Find trusted pet sitters, book instantly, and stay connected with 24/7 support</div>
          </div>
          <div class="controls">
            <button class="lang-btn" data-lang="en">EN</button>
            <button class="lang-btn" data-lang="fr">FR</button>
            <button class="lang-btn" data-lang="ar">AR</button>
            <button class="chip" onclick="setHighContrast(!document.body.classList.contains('high-contrast'))" aria-pressed="false">Contrast</button>
            <button class="chip" onclick="document.body.classList.toggle('dark')">Dark</button>
          </div>
        </div>

        <div id="conversation" class="conversation" tabindex="0" aria-live="polite">
          <!-- conversation messages will appear here -->
        </div>

        <div style="margin-top:12px" class="composer" role="form" aria-label="Chat composer">
          <div class="actions">
            <button class="chip" onclick="insertQuick('Find sitter')">Find sitter</button>
            <button class="chip" onclick="insertQuick('Price')">Price</button>
            <button class="chip" onclick="insertQuick('Vaccine')">Vaccine</button>
          </div>
          <input id="chatInput" placeholder="Ask about sitters, prices or emergencies..." aria-label="Message input">
          <button class="send" id="sendBtn">Send</button>
        </div>
      </div>
    </div>

    <div style="text-align:center;margin-top:18px;color:rgba(255,255,255,0.9)" class="privacy-text" aria-hidden="true">ðŸ”’ Conversations encrypted. We never share pet health data.</div>
  </div>

  <script>
  // ====== i18n + language script (uses earlier I18N object if present) ======
  // If a full I18N object was injected earlier in the page (by your other script), prefer it.
  // We'll create a minimal fallback if not.
  if(typeof I18N !== 'undefined'){
    window._I18N = I18N;
  } else {
    window._I18N = {
      en:{hero:{title:"Your Pet's Best Friend",subtitle:"Find trusted pet sitters, book instantly, and stay connected with 24/7 support"},footer:{privacy:"ðŸ”’ Conversations encrypted. We never share pet health data."}},
      fr:{hero:{title:"Le meilleur ami de votre animal",subtitle:"Trouvez des gardiens de confiance, rÃ©servez instantanÃ©ment et restez connectÃ© 24/7"},footer:{privacy:"ðŸ”’ Conversations chiffrÃ©es. Nous ne partageons jamais les donnÃ©es de santÃ© des animaux."}},
      ar:{hero:{title:"ØµØ¯ÙŠÙ‚ Ø­ÙŠÙˆØ§Ù†Ùƒ Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚",subtitle:"Ø§Ø¹Ø«Ø± Ø¹Ù„Ù‰ Ø¬Ù„ÙŠØ³ Ù…ÙˆØ«ÙˆÙ‚ØŒ ÙˆØ§Ø­Ø¬Ø² ÙÙˆØ±Ø§Ù‹ ÙˆØªÙˆØ§ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø¯Ø§Ø± Ø§Ù„Ø³Ø§Ø¹Ø©"},footer:{privacy:"ðŸ”’ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø´ÙØ±Ø©. Ù„Ø§ Ù†Ø´Ø§Ø±Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­Ø© Ø§Ù„Ø­ÙŠÙˆØ§Ù† Ø£Ø¨Ø¯Ø§Ù‹."}}
    };
  }

  // detect language from browser
  const LANGS=['en','fr','ar'];
  function detectLang(){const l=(navigator.language||'en').slice(0,2).toLowerCase();return LANGS.includes(l)?l:'en'}
  let currentLang = detectLang();

  function applyI18n(lang){
    currentLang = lang;
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const path = el.getAttribute('data-i18n').split('.');
      let v = window._I18N[lang];
      for(const k of path){ if(v) v = v[k]; }
      if(v) el.textContent = v;
    });
    const privacy = document.querySelector('.privacy-text');
    if(privacy && window._I18N[lang] && window._I18N[lang].footer) privacy.textContent = window._I18N[lang].footer.privacy;
    document.querySelectorAll('.lang-btn').forEach(b=>{ b.classList.toggle('active', b.getAttribute('data-lang')===lang); b.setAttribute('aria-pressed', b.getAttribute('data-lang')===lang); });
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    applyI18n(currentLang);
    document.querySelectorAll('.lang-btn').forEach(btn=>btn.addEventListener('click', ()=>applyI18n(btn.getAttribute('data-lang'))));
  });

  // ====== Chat UI logic ======
  const conv = document.getElementById('conversation');
  const input = document.getElementById('chatInput');
  const sendBtn = document.getElementById('sendBtn');

  function appendMessage({who='bot', text='', time=null, withTyping=false}){
    const msg = document.createElement('div');
    msg.className = 'msg ' + (who==='user' ? 'user' : 'bot');

    const bubble = document.createElement('div');
    bubble.className = 'bubble ' + (who==='user' ? 'user' : 'bot');

    if(withTyping && who==='bot'){
      const typing = document.createElement('div'); typing.className='typing';
      typing.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
      bubble.appendChild(typing);
      msg.appendChild(bubble);
      conv.appendChild(msg);
      scrollBottom();
      return {msg,bubble,typing};
    }

    bubble.innerHTML = '<div>'+escapeHtml(text)+'</div>' + (time?('<div class="meta">'+time+'</div>'):'');
    msg.appendChild(bubble);
    conv.appendChild(msg);
    scrollBottom();
    return msg;
  }

  function escapeHtml(s){ return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

  function scrollBottom(){ conv.scrollTo({top: conv.scrollHeight, behavior:'smooth'}); }

  function insertQuick(text){ input.value = text; input.focus(); }

  async function sendMessage(){
    const text = input.value.trim(); if(!text) return;
    appendMessage({who:'user', text, time:new Date().toLocaleTimeString()});
    input.value='';

    // show typing
    const typingNode = appendMessage({who:'bot', withTyping:true});

    try{
      const resp = await sendToLex({text, sessionId: window._pawlpal_session || (window._pawlpal_session=Math.random().toString(36).slice(2))});

      // remove typing
      typingNode.bubble.remove();

      if(resp && resp.messages){
        for(const m of resp.messages){
          appendMessage({who:'bot', text:m, time:new Date().toLocaleTimeString()});
        }
      } else {
        appendMessage({who:'bot', text:'Sorry, I could not reach the service.'});
      }

    }catch(e){
      typingNode.bubble.remove();
      appendMessage({who:'bot', text:'There was an error. Please try again later.'});
      console.error(e);
    }
  }

  sendBtn.addEventListener('click', sendMessage);
  input.addEventListener('keydown', e=>{ if(e.key==='Enter') sendMessage(); });

  // initial greeting
  document.addEventListener('DOMContentLoaded', ()=>{
    setTimeout(()=>appendMessage({who:'bot', text:window._I18N[currentLang].hero.title + '
' + window._I18N[currentLang].hero.subtitle}), 600);
  });

  // ====== Lex integration placeholder (replace with your Lex runtime or proxy) ======
  async function sendToLex({text, sessionId, locale}){
    // Example: POST to your server which forwards to LexV2 runtime
    // const res = await fetch('/lex-proxy', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({sessionId,text,locale:currentLang})});
    // const json = await res.json(); return json;

    // For demo, simple rule-based replies
    await new Promise(r=>setTimeout(r,700));
    const l = text.toLowerCase();
    if(l.includes('price')||l.includes('prix')||l.includes('Ø«Ù…Ù†')) return {messages:['Estimated price: 10 TND / hour']};
    if(l.includes('sitter')||l.includes('gard')||l.includes('Ø±Ø§Ø¹ÙŠ')) return {messages:['I found 3 sitters near you. Try "Book" or "View" for details.']};
    if(l.includes('emerg')||l.includes('Ø·ÙˆØ§Ø±Ø¦')||l.includes('urgence')) return {messages:['If this is an emergency, contact your nearest emergency vet immediately. Would you like contacts?']};
    return {messages:["Sorry, I didn't get that. Try 'Find sitter' or 'Price'."]};
  }

  // ====== Accessibility helpers ======
  function setHighContrast(enable=true){ document.body.classList.toggle('high-contrast', enable); }
  window.setHighContrast = setHighContrast;

  </script>
</body>
</html>
